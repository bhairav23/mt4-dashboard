
<!DOCTYPE html>
<html>
<head>
  <title>MT4 Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>

  <style>
    body {
      font-family: Arial;
      padding: 10px;
      margin: 0;
    }

    h2 {
      font-size: 20px;
      text-align: center;
      margin-top: 10px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }

    th, td {
      text-align: left;
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 14px;
    }

    th {
      background-color: #222;
      color: white;
      cursor: pointer;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    .highlight-EURUSD { background-color: #e6f2ff !important; }
    .highlight-GBPUSD { background-color: #fff7e6 !important; }
    .highlight-USDJPY { background-color: #e6ffe6 !important; }
    .highlight-USDCHF { background-color: #f9e6ff !important; }
    .highlight-AUDUSD { background-color: #fff0f0 !important; }
    .highlight-USDCAD { background-color: #e6ffe9 !important; }
    .highlight-NZDUSD { background-color: #e6f9f0 !important; }
    .highlight-crypto  { background-color: #f0f5ff !important; }

    .rsi-high {
      color: red;
      font-weight: bold;
    }

    #filter-wrapper {
      display: flex;
      justify-content: flex-end;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }

    @media (max-width: 768px) {
      th, td {
        font-size: 12px;
        padding: 6px;
      }

      thead th,
      tbody td {
        display: none;
      }

      thead th:nth-child(1),
      thead th:nth-child(4),
      thead th:nth-child(8),
      thead th:nth-child(9),
      tbody td:nth-child(1),
      tbody td:nth-child(4),
      tbody td:nth-child(8),
      tbody td:nth-child(9) {
        display: table-cell;
      }

      #filter-wrapper,
      div.dataTables_filter {
        justify-content: flex-end;
        text-align: right;
      }
    }
  </style>
</head>
<body>
  <h2>MT4 Account Dashboard</h2>

  <div id="filter-wrapper">
    <label><input type="checkbox" id="toggle-zero-pnl"> 0 PnL</label>
    <label><input type="checkbox" id="toggle-neutral-rsi"> RSI</label>
  </div>

  <table id="dashboard-table" class="display responsive nowrap">
    <thead>
      <tr>
        <th>Label</th>
        <th>Timestamp</th>
        <th>Symbol</th>
        <th>Bid</th>
        <th>Ask</th>
        <th>Balance</th>
        <th>Equity</th>
        <th>Floating PnL</th>
        <th>RSI</th>
        <th>Buy Orders</th>
        <th>Sell Orders</th>
        <th>Buy Lots</th>
        <th>Sell Lots</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <script>
    function updateRowVisibility() {
      const showZeroPnl = $('#toggle-zero-pnl').is(':checked');
      const showNeutralRsi = $('#toggle-neutral-rsi').is(':checked');

      $('#dashboard-table tbody tr').each(function () {
        const row = $(this);
        const isZeroPnl = row.hasClass('pnl-zero');
        const isNeutralRsi = row.hasClass('rsi-neutral');

        let visible = true;
        if (!showZeroPnl && isZeroPnl) visible = false;
        if (!showNeutralRsi && isNeutralRsi) visible = false;

        row.toggle(visible);
      });
    }

    function fetchDataAndUpdateTable() {
      $.getJSON('/data', function(response) {
        const table = $('#dashboard-table').DataTable();
        table.clear();

        response.accounts.forEach(function(acc) {
          const rsiClass = (parseFloat(acc.rsi) >= 70 || parseFloat(acc.rsi) <= 30) ? 'rsi-high' : '';
          const pnlZeroClass = parseFloat(acc.floating_pnl) === 0 ? 'pnl-zero' : '';
          const rsiNeutralClass = (parseFloat(acc.rsi) > 35 && parseFloat(acc.rsi) < 65) ? 'rsi-neutral' : '';

          table.row.add([
            `<span class="${pnlZeroClass} ${rsiNeutralClass}">${acc.label}</span>`,
            acc.timestamp,
            acc.symbol,
            acc.bid,
            acc.ask,
            acc.balance,
            acc.equity,
            acc.floating_pnl,
            `<span class="${rsiClass}">${acc.rsi}</span>`,
            acc.buy_orders,
            acc.sell_orders,
            acc.buy_lots,
            acc.sell_lots
          ]);
        });

        table.draw();
        updateRowVisibility();
      });
    }

    $(document).ready(function () {
      $('#dashboard-table').DataTable({
        paging: false,
        info: false,
        searching: true,
        order: [[7, 'asc']],
        responsive: true,
        scrollX: false
      });

      $('#toggle-zero-pnl, #toggle-neutral-rsi').on('change', updateRowVisibility);

      fetchDataAndUpdateTable();
      setInterval(fetchDataAndUpdateTable, 1000);
    });
  </script>
</body>
</html>
